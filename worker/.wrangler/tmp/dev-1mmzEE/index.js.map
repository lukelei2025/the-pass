{
  "version": 3,
  "sources": ["../bundle-GgPM8m/checked-fetch.js", "../../../src/platforms/base.ts", "../../../src/platforms/wechat.ts", "../../../src/platforms/twitter.ts", "../../../src/config/constants.ts", "../../../src/utils/html.ts", "../../../src/platforms/xiaohongshu.ts", "../../../src/platforms/douyin.ts", "../../../src/platforms/feishu.ts", "../../../src/platforms/generic.ts", "../../../src/utils/cors.ts", "../../../src/classification-rules.ts", "../../../src/index.ts", "../../../../../../.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-GgPM8m/middleware-insertion-facade.js", "../../../../../../.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/common.ts", "../bundle-GgPM8m/middleware-loader.entry.ts"],
  "sourceRoot": "/Users/lukelei/Vibe coding projects/workbench/worker/.wrangler/tmp/dev-1mmzEE",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\n * \u5E73\u53F0\u5904\u7406\u5668\u57FA\u7C7B\n *\n * \u6240\u6709\u5E73\u53F0\u5904\u7406\u5668\u5FC5\u987B\u5B9E\u73B0\u6B64\u63A5\u53E3\uFF0C\u786E\u4FDD\u4E00\u81F4\u6027\n */\n\nexport interface TitleResult {\n    title: string | null;\n    author: string;\n    cached?: boolean;\n    method?: string;\n    error?: string;\n}\n\nexport interface Env {\n    TWITTER_BEARER_TOKEN?: string;\n    GLM_API_KEY?: string;\n    JINA_API_KEY?: string;\n    KV?: KVNamespace;\n}\n\nexport interface PlatformHandler {\n    /**\n     * \u68C0\u67E5\u6B64\u5E73\u53F0\u662F\u5426\u80FD\u5904\u7406\u7ED9\u5B9A\u7684 URL\n     */\n    canHandle(url: string): boolean;\n\n    /**\n     * \u83B7\u53D6\u7F51\u9875\u6807\u9898\n     */\n    fetchTitle(url: string, env: Env): Promise<TitleResult>;\n\n    /**\n     * \u83B7\u53D6\u5E73\u53F0\u540D\u79F0\n     */\n    getName(): string;\n}\n\n/**\n * \u5E73\u53F0\u57FA\u7C7B - \u5B9A\u4E49\u63A5\u53E3\u89C4\u8303\n * \u5B50\u7C7B\u5FC5\u987B\u5B9E\u73B0 canHandle\u3001fetchTitle \u548C getName \u65B9\u6CD5\n */\nexport abstract class BasePlatform implements PlatformHandler {\n    /**\n     * \u83B7\u53D6\u5E73\u53F0\u540D\u79F0\n     */\n    abstract getName(): string;\n\n    /**\n     * \u68C0\u67E5\u662F\u5426\u80FD\u5904\u7406\u6B64 URL\uFF08\u9ED8\u8BA4\u8FD4\u56DE false\uFF09\n     */\n    canHandle(url: string): boolean {\n        return false;\n    }\n\n    /**\n     * \u83B7\u53D6\u6807\u9898\uFF08\u9ED8\u8BA4\u5B9E\u73B0\uFF0C\u5B50\u7C7B\u5E94\u91CD\u5199\uFF09\n     */\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        // \u9ED8\u8BA4\u901A\u7528\u5B9E\u73B0\n        return { title: null, author: '' };\n    }\n}\n", "/**\n * \u5FAE\u4FE1\u516C\u4F17\u53F7\u5E73\u53F0\u5904\u7406\u5668\n *\n * \u5904\u7406\u5FAE\u4FE1\u516C\u4F17\u53F7\uFF08mp.weixin.qq.com\uFF09\u7684\u6807\u9898\u6293\u53D6\n */\n\nimport { BasePlatform, TitleResult, Env } from './base';\n\nexport class WeChatPlatform extends BasePlatform {\n    getName(): string {\n        return 'wechat';\n    }\n\n    /**\n     * \u68C0\u67E5\u662F\u5426\u4E3A\u5FAE\u4FE1\u6587\u7AE0\u94FE\u63A5\n     */\n    canHandle(url: string): boolean {\n        const hostname = this.extractHostname(url);\n        return (\n            hostname.includes('mp.weixin.qq.com') ||\n            hostname.includes('weixin.qq.com')\n        );\n    }\n\n    /**\n     * \u83B7\u53D6\u5FAE\u4FE1\u6587\u7AE0\u6807\u9898\n     */\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        // \u68C0\u67E5\u7F13\u5B58\n        const cache = env.KV;\n        if (cache) {\n            const cached = await cache.get(url, 'json');\n            if (cached) {\n                return { title: cached.title, author: cached.author || '', cached: true };\n            }\n        }\n\n        try {\n            // \u4F7F\u7528\u5FAE\u4FE1\u4E13\u7528 User-Agent\n            const headers: Record<string, string> = {\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1',\n                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9',\n                'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',\n            };\n\n            const response = await fetch(url, {\n                headers,\n                redirect: 'follow',\n                cf: { cacheTtl: 3600, cacheEverything: true },\n            } as any);\n\n            if (!response.ok) {\n                return { title: null, author: '' };\n            }\n\n            const finalUrl = response.url;\n            const html = await response.text();\n\n            // \u63D0\u53D6\u6807\u9898\n            const title = this.extractTitle(html, finalUrl);\n\n            // \u5199\u5165\u7F13\u5B58\n            if (cache && title) {\n                await cache.put(url, JSON.stringify({ title, author: '' }), {\n                    expirationTtl: 3600, // 1 hour\n                });\n            }\n\n            return { title, author: '' };\n        } catch (error) {\n            console.error(`[WeChat] Fetch failed: ${error.message}`);\n            return { title: null, author: '' };\n        }\n    }\n\n    /**\n     * \u4ECE HTML \u4E2D\u63D0\u53D6\u6807\u9898\n     */\n    private extractTitle(html: string, url: string): string | null {\n        if (!html) return null;\n\n        let title: string | null = null;\n\n        // \u65B9\u6CD5 1: og:title\n        const ogMatch = html.match(/<meta[^>]*property=[\"']og:title[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n        if (ogMatch && ogMatch[1]) {\n            title = ogMatch[1].trim();\n        }\n\n        // \u65B9\u6CD5 2: \u5FAE\u4FE1\u4E13\u7528 msg_title\n        if (!title) {\n            const msgMatch = html.match(/msg_title\\s*=\\s*(?:window\\.title\\s*=\\s*)?[\"']([^\"']+)[\"']/);\n            if (msgMatch && msgMatch[1]) {\n                title = decodeURIComponent(msgMatch[1]).trim();\n            }\n        }\n\n        // \u65B9\u6CD5 3: <title> \u6807\u7B7E\n        if (!title) {\n            const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n            if (titleMatch && titleMatch[1]) {\n                title = titleMatch[1].trim();\n            }\n        }\n\n        // \u65B9\u6CD5 4: h1 \u6807\u7B7E\n        if (!title) {\n            const h1Match = html.match(/<h1[^>]*>([\\s\\S]*?)<\\/h1>/i);\n            if (h1Match && h1Match[1]) {\n                let clean = h1Match[1].replace(/<[^>]+>/g, '').trim();\n                if (clean) {\n                    title = decodeURIComponent(clean);\n                }\n            }\n        }\n\n        // \u6E05\u7406\u5C0F\u7EA2\u4E66\u7279\u6709\u7684\u6807\u9898\u540E\u7F00\n        if (title && url.includes('xiaohongshu.com')) {\n            title = title.replace(/\\s*-\\s*\u5C0F\u7EA2\u4E66$/, '');\n        }\n\n        return title;\n    }\n\n    /**\n     * \u63D0\u53D6\u4E3B\u673A\u540D\n     */\n    private extractHostname(url: string): string {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname.toLowerCase();\n        } catch {\n            return '';\n        }\n    }\n\n    /**\n     * \u89E3\u7801 HTML \u5B9E\u4F53\n     */\n    private decodeEntities(text: string): string {\n        if (!text) return '';\n        return text\n            .replace(/&amp;/g, '&')\n            .replace(/&lt;/g, '<')\n            .replace(/&gt;/g, '>')\n            .replace(/&quot;/g, '\"')\n            .replace(/&#39;/g, \"'\")\n            .replace(/&nbsp;/g, ' ');\n    }\n}\n", "/**\n * Twitter/X \u5E73\u53F0\u5904\u7406\u5668\n *\n * \u5904\u7406 Twitter/X \u94FE\u63A5\u7684\u6807\u9898\u6293\u53D6\n */\n\nimport { BasePlatform, TitleResult, Env } from './base';\n\nexport class TwitterPlatform extends BasePlatform {\n    getName(): string {\n        return 'twitter';\n    }\n\n    /**\n     * \u68C0\u67E5\u662F\u5426\u4E3A Twitter/X \u94FE\u63A5\n     */\n    canHandle(url: string): boolean {\n        const hostname = this.extractHostname(url);\n        return hostname.includes('twitter.com') || hostname.includes('x.com');\n    }\n\n    /**\n     * \u83B7\u53D6 Tweet \u4FE1\u606F\n     */\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        // \u63D0\u53D6 Tweet ID\n        const tweetId = this.extractTweetId(url);\n        if (!tweetId) {\n            return { title: null, author: '' };\n        }\n\n        // \u68C0\u67E5\u7F13\u5B58\n        const cache = env.KV;\n        if (cache) {\n            const cached = await cache.get(`tweet:${tweetId}`, 'json');\n            if (cached) {\n                const titleStr = `\"${cached.title}\" #${cached.author}`;\n                return { title: titleStr, author: cached.username || '', cached: true };\n            }\n        }\n\n        return await this.fetchWithJina(url, env);\n    }\n\n    private async fetchWithJina(url: string, env: Env): Promise<TitleResult> {\n        try {\n            const cleanUrl = url.replace(/^https?:\\/\\//, '');\n            const apiUrl = `https://r.jina.ai/http://${cleanUrl}`;\n            const headers: Record<string, string> = {\n                'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n            };\n            if (env.JINA_API_KEY) {\n                headers['Authorization'] = `Bearer ${env.JINA_API_KEY}`;\n            }\n\n            const response = await fetch(apiUrl, {\n                headers,\n                signal: AbortSignal.timeout(15000),\n            } as any);\n\n            if (!response.ok) {\n                return { title: null, author: '', method: 'twitter_jina', error: `Jina HTTP ${response.status}` };\n            }\n\n            const content = await response.text();\n            const { title, author } = this.parseJinaTweet(content);\n            if (!title && !author) {\n                return { title: null, author: '', method: 'twitter_jina', error: 'Jina parse failed' };\n            }\n\n            return { title: title || null, author: author || '', method: 'twitter_jina' };\n        } catch (error: any) {\n            if (error.name === 'AbortError' || error.name === 'TimeoutError') {\n                return { title: null, author: '', method: 'twitter_jina', error: 'Jina timeout' };\n            }\n            return { title: null, author: '', method: 'twitter_jina', error: 'Jina request failed' };\n        }\n    }\n\n    private parseJinaTweet(content: string): { title: string | null; author: string | null } {\n        const titleLine = content.split('\\n').find(line => line.startsWith('Title:')) || '';\n        if (titleLine) {\n            const raw = titleLine.replace(/^Title:\\s*/, '').trim();\n            const match = raw.match(/^(.*?)\\s+on X:\\s+\"([\\s\\S]*?)\"\\s*\\/\\s*X$/);\n            if (match) {\n                return { author: match[1].trim(), title: match[2].trim() };\n            }\n            const fallback = raw.replace(/\\s*\\/\\s*X$/i, '').trim();\n            if (fallback) {\n                return { author: null, title: fallback };\n            }\n        }\n\n        const paragraphMatch = content.match(/\\nMarkdown Content:\\n([\\s\\S]+)/);\n        if (paragraphMatch?.[1]) {\n            const firstLine = paragraphMatch[1].split('\\n').find(line => line.trim().length > 0);\n            if (firstLine) {\n                return { author: null, title: firstLine.trim() };\n            }\n        }\n\n        return { title: null, author: null };\n    }\n\n    /**\n     * \u4ECE URL \u63D0\u53D6 Tweet ID\n     */\n    private extractTweetId(url: string): string | null {\n        const patterns = [\n            /twitter\\.com\\/\\w+\\/status\\/(\\d+)/,\n            /x\\.com\\/\\w+\\/status\\/(\\d+)/,\n            /mobile\\.twitter\\.com\\/\\w+\\/status\\/(\\d+)/,\n        ];\n\n        for (const pattern of patterns) {\n            const match = url.match(pattern);\n            if (match) return match[1];\n        }\n        return null;\n    }\n\n    /**\n     * \u63D0\u53D6\u4E3B\u673A\u540D\n     */\n    private extractHostname(url: string): string {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname.toLowerCase();\n        } catch {\n            return '';\n        }\n    }\n}\n", "/**\n * Worker \u914D\u7F6E\u5E38\u91CF\n */\n\nexport const CONFIG = {\n    CACHE_TTL: 300, // 5\u5206\u949F\u7F13\u5B58\n    TIMEOUT: 15000, // 15\u79D2\u8D85\u65F6\n} as const;\n\nexport const USER_AGENTS = {\n    GENERIC: 'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.google.com/bot.html)',\n    XIAOHOUGSHU: 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1',\n    WECHAT: 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1',\n    DOUYIN: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n} as const;\n", "/**\n * HTML \u89E3\u6790\u5DE5\u5177\n */\n\n/**\n * \u89E3\u7801 HTML \u5B9E\u4F53\n */\nexport function decodeEntities(text: string | null): string {\n    if (!text) return '';\n    return text\n        .replace(/&amp;/g, '&')\n        .replace(/&lt;/g, '<')\n        .replace(/&gt;/g, '>')\n        .replace(/&quot;/g, '\"')\n        .replace(/&#39;/g, \"'\")\n        .replace(/&nbsp;/g, ' ')\n        .trim();\n}\n\n/**\n * \u4ECE HTML \u4E2D\u63D0\u53D6\u6807\u9898\uFF08\u591A\u79CD\u65B9\u6CD5\uFF09\n */\nexport function extractTitleFromHtml(html: string): string | null {\n    if (!html) return null;\n\n    let title: string | null = null;\n\n    // \u65B9\u6CD5 1: og:title\n    const ogMatch = html.match(/<meta[^>]*property=[\"']og:title[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    if (ogMatch && ogMatch[1]) {\n        title = decodeEntities(ogMatch[1]).trim();\n    }\n\n    // \u65B9\u6CD5 2: <title> \u6807\u7B7E\n    if (!title) {\n        const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n        if (titleMatch && titleMatch[1]) {\n            title = decodeEntities(titleMatch[1]).trim();\n        }\n    }\n\n    // \u65B9\u6CD5 3: h1 \u6807\u7B7E\n    if (!title) {\n        const h1Match = html.match(/<h1[^>]*>([\\s\\S]*?)<\\/h1>/i);\n        if (h1Match && h1Match[1]) {\n            let clean = h1Match[1].replace(/<[^>]+>/g, '').trim();\n            if (clean) {\n                title = decodeEntities(clean);\n            }\n        }\n    }\n\n    return title;\n}\n", "\n/**\n * \u5C0F\u7EA2\u4E66\u5E73\u53F0\u5904\u7406\u5668\n *\n * \u5904\u7406\u5C0F\u7EA2\u4E66\u94FE\u63A5\u7684\u6807\u9898\u6293\u53D6\n */\n\nimport { BasePlatform, TitleResult, Env } from './base';\nimport { CONFIG, USER_AGENTS } from '../config/constants';\nimport { decodeEntities } from '../utils/html';\n\ninterface XiaohongshuResult {\n    title?: string;\n    author?: string;\n    description?: string;\n    method?: string;\n    error?: string;\n}\n\nexport class XiaohongshuPlatform extends BasePlatform {\n    getName(): string {\n        return 'xiaohongshu';\n    }\n\n    /**\n     * \u68C0\u67E5\u662F\u5426\u4E3A\u5C0F\u7EA2\u4E66\u94FE\u63A5\n     */\n    canHandle(url: string): boolean {\n        const hostname = this.extractHostname(url);\n        return hostname.includes('xiaohongshu.com') || hostname.includes('xhslink.com');\n    }\n\n    /**\n     * \u83B7\u53D6\u5C0F\u7EA2\u4E66\u6807\u9898\n     */\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        const noteId = await this.extractNoteId(url);\n        if (!noteId) {\n            return { title: null, author: '' };\n        }\n\n        // \u68C0\u67E5\u7F13\u5B58\n        const cache = env.KV;\n        if (cache) {\n            const cached = await cache.get(`xhs:${noteId}`, 'json') as any;\n            if (cached && cached.title && !this.isInvalidTitle(cached.title)) {\n                // If cached author has .create, clear it but keep title\n                let author = cached.author || '';\n                if (author.includes('.create')) author = '';\n\n                const titleStr = author ? `${cached.title} #${author}` : `${cached.title}`;\n                return { title: titleStr, author, cached: true };\n            }\n        }\n\n        const methods = [\n            () => this.fetchWithMetaTags(url), // Try Meta Tags + JSON first (More reliable for official page)\n            () => this.fetchWithJinaReader(url, env),\n        ];\n\n        for (const method of methods) {\n            try {\n                const result = await method();\n                if (result?.error) {\n                    continue;\n                }\n\n                if (result?.title && !this.isInvalidTitle(result.title)) {\n                    const title = result.title.replace(/\\s*-\\s*\u5C0F\u7EA2\u4E66$/, '').trim();\n                    let author = result.author || '';\n\n                    if (author.includes('.create')) {\n                        author = '';\n                    }\n\n                    if (cache && title) {\n                        await cache.put(`xhs:${noteId}`, JSON.stringify({ title, author }), {\n                            expirationTtl: 3600,\n                        });\n                    }\n\n                    const titleStr = author ? `${title} #${author}` : `${title}`;\n                    return { title: titleStr, author };\n                }\n            } catch (error: any) {\n                console.error(`[\u5C0F\u7EA2\u4E66] Fetch failed: ${error.message}`);\n                continue;\n            }\n        }\n\n        return { title: null, author: '' };\n    }\n\n    /**\n     * \u4ECE URL \u63D0\u53D6\u7B14\u8BB0 ID\n     */\n    private async extractNoteId(url: string): Promise<string | null> {\n        try {\n            const urlObj = new URL(url);\n\n            // Standard: https://www.xiaohongshu.com/explore/ID\n            const exploreMatch = urlObj.pathname.match(/\\/explore\\/([a-f0-9]+)/i);\n            if (exploreMatch) {\n                return exploreMatch[1];\n            }\n\n            // Short link: https://xhslink.com/XXXX\n            if (urlObj.hostname.includes('xhslink.com')) {\n                const pathId = urlObj.pathname.replace(/^\\//, '').replace(/\\//g, '');\n                return pathId || null;\n            }\n\n            return urlObj.pathname.split('/').pop() || null;\n        } catch {\n            return null;\n        }\n    }\n\n    private async fetchWithMetaTags(url: string): Promise<XiaohongshuResult> {\n        try {\n            // Use Desktop UA to get SSR content with __INITIAL_STATE__\n            const desktopUA = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36';\n\n            const response = await fetch(url, {\n                headers: {\n                    'User-Agent': desktopUA,\n                    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8',\n                    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',\n                    'Cache-Control': 'no-cache',\n                    'Pragma': 'no-cache',\n                },\n                signal: AbortSignal.timeout(CONFIG.TIMEOUT),\n                redirect: 'follow',\n            });\n\n            if (!response.ok) {\n                return { error: `HTTP ${response.status}` };\n            }\n\n            const html = await response.text();\n\n            let title = '';\n            let author = '';\n            let description = '';\n\n            // 1. Try robust JSON extraction first (Most reliable)\n            const stateResult = this.extractFromInitialState(html);\n            if (stateResult) {\n                if (stateResult.title && !this.isInvalidTitle(stateResult.title)) title = stateResult.title;\n                if (stateResult.author) author = stateResult.author;\n                if (stateResult.desc) description = stateResult.desc;\n            }\n\n            // 2. Fallback to Meta Tags if JSON failed or missing title\n            if (this.isInvalidTitle(title)) {\n                const titleMatch = html.match(/<meta property=\"og:title\" content=\"([^\"]+)\"/);\n                const descMatch = html.match(/<meta property=\"og:description\" content=\"([^\"]+)\"/);\n\n                const metaTitle = titleMatch ? decodeEntities(titleMatch[1]) : '';\n                const metaDesc = descMatch ? decodeEntities(descMatch[1]) : '';\n\n                if (!this.isInvalidTitle(metaTitle)) {\n                    title = metaTitle;\n                } else if (metaDesc) {\n                    // Use description as title if title is vlog\n                    title = metaDesc.length > 50 ? `${metaDesc.substring(0, 50)}...` : metaDesc;\n                }\n\n                if (!description) description = metaDesc;\n            }\n\n            // 3. Fallback to <title> tag\n            if (this.isInvalidTitle(title)) {\n                const tagMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n                if (tagMatch) {\n                    const tagTitle = decodeEntities(tagMatch[1]).replace(/\\s*-\\s*\u5C0F\u7EA2\u4E66$/, '').trim();\n                    if (!this.isInvalidTitle(tagTitle)) {\n                        title = tagTitle;\n                    }\n                }\n            }\n\n            // 4. Fallback Author regex\n            if (!author) {\n                const authMatch = html.match(/\"nickname\":\"([^\"]+)\"/);\n                if (authMatch) author = authMatch[1];\n            }\n\n            // Final validation\n            if (this.isInvalidTitle(title)) {\n                return { error: 'Generic title' };\n            }\n\n            return {\n                title: title.trim(),\n                author,\n                description,\n                method: 'meta_tags',\n            };\n        } catch (error: any) {\n            if (error.name === 'AbortError' || error.name === 'TimeoutError') {\n                return { error: 'Timeout' };\n            }\n            return { error: error.message };\n        }\n    }\n\n    /**\n     * Validates and extracts JSON from window.__INITIAL_STATE__\n     */\n    private extractFromInitialState(html: string): { title?: string, author?: string, desc?: string } | null {\n        const marker = 'window.__INITIAL_STATE__=';\n        const startIndex = html.indexOf(marker);\n        if (startIndex === -1) return null;\n\n        let cursor = startIndex + marker.length;\n        // Skip whitespace\n        while (cursor < html.length && /\\s/.test(html[cursor])) cursor++;\n\n        if (html[cursor] !== '{') return null;\n\n        // Simple stack-based extraction\n        let balance = 0;\n        let inString = false;\n        let escaped = false;\n        let startJson = cursor;\n\n        for (let i = cursor; i < html.length; i++) {\n            const char = html[i];\n\n            if (escaped) {\n                escaped = false;\n                continue;\n            }\n\n            if (char === '\\\\') {\n                escaped = true;\n                continue;\n            }\n\n            if (char === '\"') {\n                inString = !inString;\n                continue;\n            }\n\n            if (!inString) {\n                if (char === '{') balance++;\n                else if (char === '}') {\n                    balance--;\n                    if (balance === 0) {\n                        const jsonStr = html.substring(startJson, i + 1);\n                        try {\n                            const cleanJson = jsonStr.replace(/undefined/g, 'null');\n                            const data = JSON.parse(cleanJson);\n\n                            // Traverse common paths\n                            let title, author, desc;\n\n                            // Path 1: note.note\n                            if (data?.note?.note) {\n                                title = data.note.note.title;\n                                desc = data.note.note.desc;\n                                author = data.note.note.user?.nickname || data.note.note.user?.name;\n                            }\n                            // Path 2: note.firstNote\n                            else if (data?.note?.firstNote) {\n                                title = data.note.firstNote.title;\n                                desc = data.note.firstNote.desc;\n                                author = data.note.firstNote.user?.nickname || data.note.firstNote.user?.name;\n                            }\n                            // Path 3: note.noteDetailMap (Map of notes)\n                            else if (data?.note?.noteDetailMap) {\n                                const vals = Object.values(data.note.noteDetailMap) as any[];\n                                if (vals.length > 0) {\n                                    const note = vals[0].note || vals[0]; // Sometimes nested\n                                    title = note.title;\n                                    desc = note.desc;\n                                    author = note.user?.nickname || note.user?.name;\n                                }\n                            }\n\n                            return { title, author, desc };\n\n                        } catch (e) {\n                            return null;\n                        }\n                    }\n                }\n            }\n        }\n        return null;\n    }\n\n    /**\n     * \u4F7F\u7528 Jina Reader API \u83B7\u53D6\u4FE1\u606F\n     */\n    private async fetchWithJinaReader(url: string, env: Env): Promise<XiaohongshuResult> {\n        try {\n            const cleanUrl = url.replace(/^https?:\\/\\//, '');\n            const apiUrl = `https://r.jina.ai/http://${cleanUrl}`;\n            const headers: Record<string, string> = { 'User-Agent': USER_AGENTS.XIAOHOUGSHU };\n            if (env.JINA_API_KEY) {\n                headers['Authorization'] = `Bearer ${env.JINA_API_KEY}`;\n            }\n\n            const response = await fetch(apiUrl, {\n                headers,\n                signal: AbortSignal.timeout(CONFIG.TIMEOUT),\n            });\n\n            if (response.status === 429) {\n                return { error: 'Rate limit exceeded' };\n            }\n            if (!response.ok) {\n                return { error: `HTTP ${response.status}` };\n            }\n\n            const content = await response.text();\n            const result = this.parseXiaohongshuContent(content);\n            return { ...result, method: 'jina_reader' };\n        } catch (error: any) {\n            if (error.name === 'AbortError' || error.name === 'TimeoutError') {\n                return { error: 'Timeout' };\n            }\n            return { error: error.message };\n        }\n    }\n\n    private parseXiaohongshuContent(content: string): XiaohongshuResult {\n        const result: XiaohongshuResult = {\n            title: '',\n            author: '',\n            description: '',\n        };\n\n        let cleanContent = content\n            .replace(/={20,}/g, '')\n            .replace(/\\r\\n/g, '\\n')\n            .replace(/\\r/g, '\\n');\n\n        const titleMatch1 = cleanContent.match(/^Title:\\s*([^\\n]+?)\\s*-\\s*\u5C0F\u7EA2\u4E66/m);\n        if (titleMatch1) {\n            result.title = titleMatch1[1].trim();\n        }\n\n        if (!result.title) {\n            const titleMatch2 = cleanContent.match(/^([^\\n]+?)\\s*-\\s*\u5C0F\u7EA2\u4E66/m);\n            if (titleMatch2) {\n                result.title = titleMatch2[1].trim();\n            }\n        }\n\n        if (!result.title) {\n            const titleMatch3 = cleanContent.match(/^Title:\\s*([^\\n]+)/m);\n            if (titleMatch3) {\n                result.title = titleMatch3[1].trim();\n            }\n        }\n\n        if (!result.title) {\n            const firstLine = cleanContent.split('\\n')[0];\n            if (firstLine && !firstLine.includes('Title:') && firstLine.length < 100) {\n                result.title = firstLine.trim();\n            }\n        }\n\n        const authorPatterns = [\n            /by\\s+([a-zA-Z0-9_\\u4e00-\\u9fa5]+)/i,\n            /\u53D1\u5E03\u8005[:\uFF1A]\\s*([a-zA-Z0-9_\\u4e00-\\u9fa5]+)/,\n            /\u4F5C\u8005[:\uFF1A]\\s*([a-zA-Z0-9_\\u4e00-\\u9fa5]+)/,\n        ];\n\n        for (const pattern of authorPatterns) {\n            const match = cleanContent.match(pattern);\n            if (match && match[1] && !result.author) {\n                if (!match[1].includes('.create')) {\n                    result.author = match[1];\n                    break;\n                }\n            }\n        }\n        return result;\n    }\n\n    private extractHostname(url: string): string {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname.toLowerCase();\n        } catch {\n            return '';\n        }\n    }\n\n    private isInvalidTitle(title: string | undefined | null): boolean {\n        if (!title) return true;\n\n        const lower = title.toLowerCase().trim();\n        if (lower === '' || lower === 'vlog' || lower === '\u5C0F\u7EA2\u4E66') return true;\n\n        const stripped = lower.replace(/[^a-z0-9\\u4e00-\\u9fa5]/g, '');\n        if (stripped === 'vlog') return true;\n\n        return false;\n    }\n}\n", "\n/**\n * \u6296\u97F3\u5E73\u53F0\u5904\u7406\u5668\n *\n * \u5904\u7406\u6296\u97F3/TikTok \u94FE\u63A5\u7684\u6807\u9898\u6293\u53D6\n */\n\nimport { BasePlatform, TitleResult, Env } from './base';\n\nexport class DouyinPlatform extends BasePlatform {\n    getName(): string {\n        return 'douyin';\n    }\n\n    /**\n     * \u68C0\u67E5\u662F\u5426\u4E3A\u6296\u97F3\u94FE\u63A5\n     */\n    canHandle(url: string): boolean {\n        const hostname = this.extractHostname(url);\n        return hostname.includes('douyin.com') || hostname.includes('v.douyin.com');\n    }\n\n    /**\n     * \u83B7\u53D6\u6296\u97F3\u89C6\u9891\u6807\u9898\n     */\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        const resolvedUrl = await this.resolveShortLink(url);\n        try {\n            const headers: Record<string, string> = {\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1',\n            };\n\n            const response = await fetch(resolvedUrl, {\n                headers,\n                redirect: 'follow',\n                cf: { cacheTtl: 3600, cacheEverything: true },\n            } as any);\n\n            if (!response.ok) {\n                return { title: null, author: '', method: 'douyin_html', error: `HTTP ${response.status}` };\n            }\n\n            const html = await response.text();\n\n            // \u6296\u97F3\u8FD4\u56DE\u7684\u6570\u636E\u5728 window._ROUTER_DATA \u4E2D\n            const { title: rawTitle, author } = this.extractMetadataFromHtml(html);\n\n            let title = rawTitle;\n            if (title) {\n                title = author ? `${title} #${author}` : `${title}`;\n            }\n\n            return { title, author, method: 'douyin_html' };\n        } catch (error: any) {\n            console.error(`[Douyin] Fetch failed: ${error.message}`);\n            return { title: null, author: '', method: 'douyin_html', error: 'Request failed' };\n        }\n    }\n\n    private async resolveShortLink(url: string): Promise<string> {\n        if (!url.includes('v.douyin.com')) {\n            return url;\n        }\n\n        try {\n            const response = await fetch(url, {\n                redirect: 'manual',\n                headers: {\n                    'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1',\n                },\n            } as any);\n\n            const location = response.headers.get('location');\n            if (location) {\n                return location;\n            }\n\n            return response.url || url;\n        } catch {\n            return url;\n        }\n    }\n\n    /**\n     * \u4ECE HTML \u4E2D\u63D0\u53D6\u6807\u9898\n     */\n    private extractMetadataFromHtml(html: string): { title: string | null; author: string } {\n        if (!html) return { title: null, author: '' };\n\n        const routerIndex = html.indexOf('window._ROUTER_DATA');\n        if (routerIndex !== -1) {\n            try {\n                const braceStart = html.indexOf('{', routerIndex);\n                const scriptEnd = html.indexOf('</script>', braceStart);\n                if (braceStart !== -1 && scriptEnd !== -1) {\n                    let jsonStr = html.slice(braceStart, scriptEnd).trim();\n                    if (jsonStr.endsWith(';')) {\n                        jsonStr = jsonStr.slice(0, -1);\n                    }\n                    jsonStr = jsonStr.replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\");\n                    const data = JSON.parse(jsonStr);\n                    const item = data?.loaderData?.['video_(id)/page']?.videoInfoRes?.item_list?.[0];\n                    if (item) {\n                        let title = item.desc || '';\n                        const author = item.author?.nickname || '';\n\n                        title = title.replace(/#\\S+\\s*/g, ' ').trim();\n                        // Truncate to 40 chars\n                        if (title.length > 40) {\n                            title = title.substring(0, 40) + '...';\n                        }\n\n                        if (!title) {\n                            const fallback = this.fallbackTitleExtraction(html);\n                            return { title: fallback, author };\n                        }\n\n                        return { title: title || null, author };\n                    }\n                }\n            } catch {\n            }\n        }\n\n        const fallback = this.fallbackTitleExtraction(html);\n        return { title: fallback, author: '' };\n    }\n\n    /**\n     * \u5907\u7528\u6807\u9898\u63D0\u53D6\u65B9\u6CD5\n     */\n    private fallbackTitleExtraction(html: string): string | null {\n        if (!html) return null;\n\n        // \u5C1D\u8BD5\u4ECE <title> \u6807\u7B7E\u63D0\u53D6\n        const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n        if (titleMatch && titleMatch[1]) {\n            return titleMatch[1].trim();\n        }\n\n        return null;\n    }\n\n    /**\n     * \u63D0\u53D6\u4E3B\u673A\u540D\n     */\n    private extractHostname(url: string): string {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname.toLowerCase();\n        } catch {\n            return '';\n        }\n    }\n}\n", "import { BasePlatform, TitleResult, Env } from './base';\nimport { USER_AGENTS } from '../config/constants';\nimport { extractTitleFromHtml } from '../utils/html';\n\nexport class FeishuPlatform extends BasePlatform {\n    getName(): string {\n        return 'feishu';\n    }\n\n    canHandle(url: string): boolean {\n        const hostname = this.extractHostname(url);\n        return hostname.includes('feishu.cn') || hostname.includes('feishu.com');\n    }\n\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        try {\n            const cleanUrl = url.replace(/^https?:\\/\\//, '');\n            const apiUrl = `https://r.jina.ai/http://${cleanUrl}`;\n            const headers: Record<string, string> = {\n                'User-Agent': USER_AGENTS.GENERIC,\n            };\n            if (env.JINA_API_KEY) {\n                headers['Authorization'] = `Bearer ${env.JINA_API_KEY}`;\n            }\n\n            const response = await fetch(apiUrl, { headers, signal: AbortSignal.timeout(15000) } as any);\n            if (!response.ok) {\n                return { title: null, author: '' };\n            }\n\n            const content = await response.text();\n            const author = this.extractAuthor(content);\n            const title = this.extractTitle(content);\n\n            if (title) {\n                return { title, author };\n            }\n        } catch {\n        }\n\n        return await this.fetchFromHtml(url);\n    }\n\n    private async fetchFromHtml(url: string): Promise<TitleResult> {\n        try {\n            const response = await fetch(url, {\n                headers: { 'User-Agent': USER_AGENTS.GENERIC },\n                redirect: 'follow',\n                signal: AbortSignal.timeout(15000),\n            } as any);\n            if (!response.ok) {\n                return { title: null, author: '' };\n            }\n\n            const html = await response.text();\n            const title = extractTitleFromHtml(html);\n            if (!title) {\n                return { title: null, author: '' };\n            }\n\n            return { title, author: '' };\n        } catch {\n            return { title: null, author: '' };\n        }\n    }\n\n    private extractAuthor(content: string): string {\n        const authorPatterns = [\n            /\u521B\u5EFA\u8005[\uFF1A:]\\s*([^\\n\\r]+)/i,\n            /\u4F5C\u8005[\uFF1A:]\\s*([^\\n\\r]+)/i,\n            /by\\s+([^\\n\\r]+)/i,\n            /\u6587\u6863\u6240\u6709\u8005[\uFF1A:]\\s*([^\\n\\r]+)/i,\n        ];\n\n        for (const pattern of authorPatterns) {\n            const match = content.match(pattern);\n            if (match && match[1]?.trim()) {\n                return match[1].trim();\n            }\n        }\n\n        return '';\n    }\n\n    private extractTitle(content: string): string | null {\n        const firstLine = content.split('\\n')[0]?.trim();\n        if (!firstLine) {\n            return null;\n        }\n\n        let title = firstLine.replace(/^Title:\\s*/i, '').trim();\n        title = title.replace(/\\s*-\\s*Feishu\\s*Docs$/i, '').trim();\n        if (!title) {\n            return null;\n        }\n\n        if (title.length > 100) {\n            return title.substring(0, 100);\n        }\n\n        return title;\n    }\n\n    private extractHostname(url: string): string {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname.toLowerCase();\n        } catch {\n            return '';\n        }\n    }\n}\n", "/**\n * \u901A\u7528\u5E73\u53F0\u5904\u7406\u5668\uFF08\u515C\u5E95\uFF09\n *\n * \u5904\u7406\u4E0D\u88AB\u5176\u4ED6\u5E73\u53F0\u8BC6\u522B\u7684\u901A\u7528\u7F51\u5740\n */\n\nimport { BasePlatform, TitleResult, Env } from './base';\n\nexport class GenericPlatform extends BasePlatform {\n    getName(): string {\n        return 'generic';\n    }\n\n    /**\n     * \u515C\u5E95\u5904\u7406\u5668\u53EF\u4EE5\u5904\u7406\u6240\u6709 URL\n     */\n    canHandle(url: string): boolean {\n        return true;\n    }\n\n    /**\n     * \u901A\u7528\u6807\u9898\u6293\u53D6\n     */\n    async fetchTitle(url: string, env: Env): Promise<TitleResult> {\n        // \u68C0\u67E5\u7F13\u5B58\n        const cache = env.KV;\n        if (cache) {\n            const cached = await cache.get(url, 'json');\n            if (cached) {\n                return { title: cached.title, author: cached.author || '', cached: true };\n            }\n        }\n\n        try {\n            // \u4F7F\u7528\u901A\u7528\u7684 User-Agent\n            const headers: Record<string, string> = {\n                'User-Agent': 'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.google.com/bot.html)',\n            };\n\n            const response = await fetch(url, {\n                headers,\n                redirect: 'follow',\n                cf: { cacheTtl: 3600, cacheEverything: true },\n            } as any);\n\n            if (!response.ok) {\n                return { title: null, author: '' };\n            }\n\n            const finalUrl = response.url;\n            const html = await response.text();\n\n            // \u63D0\u53D6\u6807\u9898\n            const title = this.extractTitle(html);\n\n            // \u5199\u5165\u7F13\u5B58\n            if (cache && title) {\n                await cache.put(url, JSON.stringify({ title, author: '' }), {\n                    expirationTtl: 3600,\n                });\n            }\n\n            return { title, author: '' };\n        } catch (error: any) {\n            console.error(`[Generic] Fetch failed: ${error.message}`);\n            return { title: null, author: '' };\n        }\n    }\n\n    /**\n     * \u4ECE HTML \u4E2D\u63D0\u53D6\u6807\u9898\uFF08\u591A\u79CD\u65B9\u6CD5\uFF09\n     */\n    private extractTitle(html: string): string | null {\n        if (!html) return null;\n\n        let title: string | null = null;\n\n        // \u65B9\u6CD5 1: og:title\n        const ogMatch = html.match(/<meta[^>]*property=[\"']og:title[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n        if (ogMatch && ogMatch[1]) {\n            title = ogMatch[1].trim();\n        }\n\n        // \u65B9\u6CD5 2: <title> \u6807\u7B7E\n        if (!title) {\n            const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n            if (titleMatch && titleMatch[1]) {\n                title = titleMatch[1].trim();\n            }\n        }\n\n        // \u65B9\u6CD5 3: h1 \u6807\u7B7E\n        if (!title) {\n            const h1Match = html.match(/<h1[^>]*>([\\s\\S]*?)<\\/h1>/i);\n            if (h1Match && h1Match[1]) {\n                let clean = h1Match[1].replace(/<[^>]+>/g, '').trim();\n                if (clean) {\n                    title = clean;\n                }\n            }\n        }\n\n        return title;\n    }\n}\n", "/**\n * CORS \u5DE5\u5177\n */\n\n/**\n * \u521B\u5EFA CORS \u54CD\u5E94\u5934\n */\nexport function createCorsHeaders(): Record<string, string> {\n    return {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n    };\n}\n\n/**\n * \u521B\u5EFA OPTIONS \u9884\u68C0\u54CD\u5E94\n */\nexport function createOptionsResponse(): Response {\n    return new Response(null, {\n        status: 204,\n        headers: {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n        },\n    });\n}\n", "/**\n * \u5185\u5BB9\u5206\u7C7B\u89C4\u5219 SOP\n * \u5927\u6A21\u578B\u6839\u636E\u6B64\u89C4\u5219\u5BF9\u4E22\u8FDB\u6765\u7684\u5185\u5BB9\u8FDB\u884C\u667A\u80FD\u5206\u7C7B\n */\n\nexport const CLASSIFICATION_RULES = `\n# Content Classification Rules (SOP) / \u5185\u5BB9\u5206\u7C7B\u89C4\u5219\n\nYou are the intelligent classification assistant for a digital workbench. Please classify the user's input into one of the following 5 categories based on these rules.\n\u4F60\u662F\u6570\u5B57\u5DE5\u4F5C\u53F0\u7684\u667A\u80FD\u5206\u7C7B\u52A9\u624B\u3002\u8BF7\u6839\u636E\u4EE5\u4E0B\u89C4\u5219\u5C06\u7528\u6237\u8F93\u5165\u5206\u7C7B\u4E3A 5 \u4E2A\u7C7B\u522B\u4E4B\u4E00\u3002\n\n---\n\n## Classification Targets / \u5206\u7C7B\u76EE\u6807\n\nClassify content into one of these 5 categories:\n\u8BF7\u5C06\u5185\u5BB9\u5F52\u7C7B\u4E3A\u4EE5\u4E0B 5 \u7C7B\u4E4B\u4E00\uFF1A\n\n| Category | Label | Description (EN) | Description (CN) |\n|----------|-------|------------------|------------------|\n| \uD83D\uDCA1 Ideas | ideas | Flashes of inspiration, creative ideas, fleeting thoughts. | \u7075\u611F\u95EA\u73B0\u3001\u521B\u610F\u60F3\u6CD5\u3001\u7A0D\u7EB5\u5373\u901D\u7684\u5FF5\u5934\u3002 |\n| \uD83D\uDCBC Work | work | Work-related tasks, projects, technical content, meetings. | \u5DE5\u4F5C\u4EFB\u52A1\u3001\u9879\u76EE\u3001\u6280\u672F\u5185\u5BB9\u3001\u4F1A\u8BAE\u3002 |\n| \uD83C\uDFE0 Personal | personal | Personal affairs, family, shopping, health, life admin. | \u4E2A\u4EBA\u4E8B\u52A1\u3001\u5BB6\u5EAD\u3001\u8D2D\u7269\u3001\u5065\u5EB7\u3001\u751F\u6D3B\u7410\u4E8B\u3002 |\n| \uD83D\uDD17 External | external | Articles to read, videos to watch, external resources (Read Later). | \u5F85\u8BFB\u6587\u7AE0\u3001\u5F85\u770B\u89C6\u9891\u3001\u5916\u90E8\u8D44\u6E90\uFF08\u7A0D\u540E\u9605\u8BFB\uFF09\u3002 |\n| \uD83D\uDCDD Others | others | Content that clearly doesn't fit the above categories. | \u663E\u7136\u4E0D\u5C5E\u4E8E\u4E0A\u8FF0\u7C7B\u522B\u7684\u5185\u5BB9\u3002 |\n\n---\n\n## \uD83D\uDEAB Noise Filtering (Critical) / \u566A\u97F3\u8FC7\u6EE4\uFF08\u5173\u952E\uFF09\n\nUser input may contain redundant text from App sharing (Noise), which does NOT represent user intent. Ignore:\n\u7528\u6237\u8F93\u5165\u53EF\u80FD\u5305\u542B\u6765\u81EA App \u5206\u4EAB\u7684\u5197\u4F59\u6587\u672C\uFF08\u566A\u97F3\uFF09\uFF0C\u8FD9\u4E0D\u4EE3\u8868\u7528\u6237\u610F\u56FE\u3002\u8BF7\u5FFD\u7565\uFF1A\n\n- \"Copy and open [Platform]...\" / \"\u590D\u5236\u6253\u5F00...\"\n- \"Top comments...\" / \"\u770B\u770B\u8BC4\u8BBA...\"\n- \"@Username's video...\" / \"@\u67D0\u67D0\u7684\u89C6\u9891...\"\n- \"#Tags\"\n- The link itself (http...) / \u94FE\u63A5\u672C\u8EAB\n- The original title embedded in the share text / \u5206\u4EAB\u6587\u672C\u4E2D\u5D4C\u5165\u7684\u539F\u6807\u9898\n\n**Core Principle: Distinguish between \"description of content\" and \"user's added note\". Only user's added note determines the intent.**\n**\u6838\u5FC3\u539F\u5219\uFF1A\u533A\u5206\u201C\u5185\u5BB9\u63CF\u8FF0\u201D\u548C\u201C\u7528\u6237\u9644\u52A0\u7B14\u8BB0\u201D\u3002\u53EA\u6709\u7528\u6237\u7684\u9644\u52A0\u7B14\u8BB0\u51B3\u5B9A\u771F\u5B9E\u610F\u56FE\u3002**\n\n---\n\n## Classification Priority / \u5206\u7C7B\u4F18\u5148\u7EA7\n\n**Check in this order / \u6309\u6B64\u987A\u5E8F\u68C0\u67E5:**\n\n### 1. Link Recognition (URL) / \u94FE\u63A5\u8BC6\u522B\n\n**Core Rule: All pure links (without user note, or only with platform noise) are classified as \\`external\\` (External).**\n**\u6838\u5FC3\u89C4\u5219\uFF1A\u6240\u6709\u7EAF\u94FE\u63A5\uFF08\u65E0\u7528\u6237\u7B14\u8BB0\uFF0C\u6216\u4EC5\u542B\u5E73\u53F0\u566A\u97F3\uFF09\u5747\u5F52\u7C7B\u4E3A \\`external\\`\u3002**\n\nOnly if the user adds a specific note expressing personal intent does it change category:\n\u53EA\u6709\u5F53\u7528\u6237\u6DFB\u52A0\u4E86\u8868\u8FBE\u4E2A\u4EBA\u610F\u56FE\u7684\u5177\u4F53\u7B14\u8BB0\u65F6\uFF0C\u624D\u6539\u53D8\u5206\u7C7B\uFF1A\n\n| Scenario | Category | Reasoning |\n|----------|----------|-----------|\n| Pure Link | external | Default Read Later / \u9ED8\u8BA4\u7A0D\u540E\u8BFB |\n| Link + \"Copy to open...\" | external | Noise ignored / \u5FFD\u7565\u566A\u97F3 |\n| Link + \"Review later\" | work | User work intent / \u5DE5\u4F5C\u610F\u56FE |\n| Link + \"Buy this\" | personal | User shopping intent / \u8D2D\u7269\u610F\u56FE |\n| Link + \"Great idea\" | ideas | User inspiration / \u7075\u611F\u610F\u56FE |\n\n### 1.5 Specific Platform Rules / \u7279\u5B9A\u5E73\u53F0\u89C4\u5219\n\n1.  **Xiaohongshu (Red) / TikTok / Bilibili / YouTube** -> **external**\n    - These are content consumption platforms. Default to external.\n    - \u5C0F\u7EA2\u4E66\u3001\u6296\u97F3\u3001B\u7AD9\u3001YouTube -> **external**\n    - Even if the title contains \"idea\" or \"tutorial\", it is external (resource) unless the user says \"I want to do this\".\n\n### 2. Keyword Matching / \u5173\u952E\u8BCD\u5339\u914D\n\n**\uD83D\uDCA1 ideas (Inspiration/\u7075\u611F):**\n- Triggers: idea, thought, maybe, what if, inspiration, concept, brainstorm, \"suddenly thought of\", \"could try\".\n- \u89E6\u53D1\u8BCD\uFF1A\u60F3\u6CD5\u3001\u7075\u611F\u3001\u5FF5\u5934\u3001\u6216\u8BB8\u3001\u5982\u679C\u3001\u5934\u8111\u98CE\u66B4\u3001\u201C\u7A81\u7136\u60F3\u5230\u201D\u3001\u201C\u8BD5\u4E00\u4E0B\u201D\u3002\n- Context: Creative thinking, non-actionable abstract thoughts.\n\n**\uD83D\uDCBC work (Work/\u5DE5\u4F5C):**\n- Triggers: project, meeting, deadline, bug, client, report, code, API, deploy, install, config, follow up, review, test, release.\n- \u89E6\u53D1\u8BCD\uFF1A\u9879\u76EE\u3001\u4F1A\u8BAE\u3001\u622A\u6B62\u3001\u5BA2\u6237\u3001\u62A5\u544A\u3001\u4EE3\u7801\u3001\u90E8\u7F72\u3001\u5B89\u88C5\u3001\u914D\u7F6E\u3001\u8DDF\u8FDB\u3001\u8BC4\u5BA1\u3001\u6D4B\u8BD5\u3001\u53D1\u5E03\u3002\n- Context: Professional tasks, execution-oriented.\n\n**\uD83C\uDFE0 personal (Personal/\u4E2A\u4EBA):**\n- Triggers: buy, shop, health, gym, home, dinner, travel, appointment, doctor, bill, visa, move, kids, family.\n- \u89E6\u53D1\u8BCD\uFF1A\u4E70\u3001\u901B\u3001\u5065\u5EB7\u3001\u5065\u8EAB\u3001\u5BB6\u3001\u665A\u9910\u3001\u65C5\u884C\u3001\u9884\u7EA6\u3001\u533B\u751F\u3001\u8D26\u5355\u3001\u7B7E\u8BC1\u3001\u642C\u5BB6\u3001\u5B69\u5B50\u3001\u5BB6\u5EAD\u3002\n- Context: Private life, household, consumption, well-being.\n\n**\uD83D\uDD17 external (External/\u5916\u90E8):**\n- Triggers: read, watch, check out, article, video, tutorial, learn, study.\n- \u89E6\u53D1\u8BCD\uFF1A\u8BFB\u3001\u770B\u3001\u6587\u7AE0\u3001\u89C6\u9891\u3001\u6559\u7A0B\u3001\u5B66\u4E60\u3001\u7814\u7A76\u3001\u94FE\u63A5\u3002\n- Context: Passive consumption of information.\n\n**\uD83D\uDCDD others (Others/\u5176\u4ED6):**\n- Fallback for ambiguous content or undefined short phrases.\n- \u5BF9\u6A21\u7CCA\u5185\u5BB9\u6216\u672A\u5B9A\u4E49\u77ED\u8BED\u7684\u515C\u5E95\u3002\n\n### 3. Sentence Pattern / \u53E5\u5F0F\u5206\u6790\n\n| Pattern (EN/CN) | Category |\n|-----------------|----------|\n| \"I want to...\" / \"\u6211\u60F3...\" / \"What if...\" | ideas |\n| \"Need to...\" / \"\u9700\u8981...\" / \"Remember to...\" / \"\u8BB0\u5F97...\" | work / personal |\n| \"Check this...\" / \"\u770B\u8FD9\u4E2A...\" / \"Recommended...\" / \"\u63A8\u8350...\" | external |\n| Specific time (Mon 3pm) / \u5177\u4F53\u65F6\u95F4 | work (default) or personal |\n\n---\n\n## \uD83E\uDDD0 Self-Correction Protocol / \u81EA\u67E5\u534F\u8BAE\n\n**Before outputting, you MUST perform this strict check:**\n**\u5728\u8F93\u51FA\u524D\uFF0C\u5FC5\u987B\u6267\u884C\u6B64\u4E25\u683C\u68C0\u67E5\uFF1A**\n\n1.  **Initial Judgment**: Conclusion based on keywords. (\u521D\u5224)\n2.  **Critique**: (\u6279\u5224)\n    - \"Is this category accurate?\" (\u5206\u7C7B\u51C6\u786E\u5417\uFF1F)\n    - \"Did I mistake a personal task (e.g., dentist) for 'Others'?\" (\u662F\u5426\u628A\u4E2A\u4EBA\u4EFB\u52A1\u9519\u5224\u4E3A\u5176\u4ED6\uFF1F)\n    - \"Is this just a link I should mark as 'External'?\" (\u8FD9\u662F\u5426\u53EA\u662F\u4E2A\u94FE\u63A5\u5E94\u5F52\u4E3A\u5916\u90E8\uFF1F)\n3.  **Final Verdict**: Correct if necessary. (\u6700\u7EC8\u88C1\u51B3)\n\n---\n\n## Output Format / \u8F93\u51FA\u683C\u5F0F\n\n**Return VALID JSON:**\n\n{\n    \"reasoning\": \"Your thought process and critique / \u601D\u8003\u8FC7\u7A0B\u4E0E\u6279\u5224\",\n    \"category\": \"final_category\"\n}\n\n*** Category Values MUST be one of: \"ideas\", \"work\", \"personal\", \"external\", \"others\" ***\n*** category \u503C\u5FC5\u987B\u662F\u4EE5\u4E0B\u4E4B\u4E00\uFF1A\"ideas\", \"work\", \"personal\", \"external\", \"others\" ***\n\n---\n\n## Examples / \u793A\u4F8B\n\n| Input | Category |\n|-------|----------|\n| \"Suddenly thought AI could write reports\" / \"\u7A81\u7136\u60F3\u5230AI\u53EF\u4EE5\u5199\u62A5\u544A\" | ideas |\n| \"Project idea - New workbench design\" / \"\u9879\u76EE\u70B9\u5B50 - \u65B0\u5DE5\u4F5C\u53F0\u8BBE\u8BA1\" | ideas |\n| \"Finish PRD review by Friday\" / \"\u5468\u4E94\u524D\u5B8C\u6210PRD\u8BC4\u5BA1\" | work |\n| \"Follow up with Nicole on invoice\" / \"\u8DDF\u8FDB\u4E00\u4E0B\u53D1\u7968\u7684\u4E8B\" | work |\n| \"https://mp.weixin.qq.com/s/xxx\" | external |\n| \"https://github.com/user/repo\" | external |\n| \"https://github.com/user/repo install later\" / \"...\u7A0D\u540E\u5B89\u88C5\" | work |\n| \"Watch this Bilibili tutorial\" / \"\u770B\u8FD9\u4E2AB\u7AD9\u6559\u7A0B\" | external |\n| \"Remember to buy toothbrush\" / \"\u8BB0\u5F97\u4E70\u7259\u5237\" | personal |\n| \"Book dentist appointment\" / \"\u9884\u7EA6\u770B\u7259\" | personal |\n`;\n\nexport default CLASSIFICATION_RULES;\n", "/**\n * Cloudflare Worker - \u7EDF\u4E00\u6807\u9898\u6293\u53D6\u5165\u53E3\n *\n * \u8DEF\u7531\u5230\u76F8\u5E94\u7684\u5E73\u53F0\u5904\u7406\u5668\n */\n\nimport { WeChatPlatform } from './platforms/wechat';\nimport { TwitterPlatform } from './platforms/twitter';\nimport { XiaohongshuPlatform } from './platforms/xiaohongshu';\nimport { DouyinPlatform } from './platforms/douyin';\nimport { FeishuPlatform } from './platforms/feishu';\nimport { GenericPlatform } from './platforms/generic';\nimport { createCorsHeaders, createOptionsResponse } from './utils/cors';\nimport { Env, TitleResult } from './platforms/base';\nimport { CLASSIFICATION_RULES } from './classification-rules';\nimport { USER_AGENTS } from './config/constants';\n\n// \u5E73\u53F0\u5904\u7406\u5668\u5217\u8868\uFF08\u6309\u4F18\u5148\u7EA7\u6392\u5E8F\uFF09\nconst PLATFORMS = [\n    new WeChatPlatform(),\n    new TwitterPlatform(),\n    new XiaohongshuPlatform(),\n    new DouyinPlatform(),\n    new FeishuPlatform(),\n    new GenericPlatform(), // \u515C\u5E95\n];\n\nexport default {\n    async fetch(request: Request, env: Env, ctx: any): Promise<Response> {\n        const url = new URL(request.url);\n        const targetUrl = url.searchParams.get('url');\n        const resolveOnly = url.searchParams.get('resolve') === '1';\n        const debug = url.searchParams.get('debug') === '1';\n\n        // \u5904\u7406 OPTIONS \u8BF7\u6C42\n        if (request.method === 'OPTIONS') {\n            return createOptionsResponse();\n        }\n\n        // \u5982\u679C\u662F POST \u4E14\u6CA1\u6709 url \u53C2\u6570\uFF0C\u5219\u4F5C\u4E3A\u5206\u7C7B\u8BF7\u6C42\n        if (request.method === 'POST' && !targetUrl) {\n            return handleClassify(request, env);\n        }\n\n        // \u6807\u9898\u6293\u53D6\u8BF7\u6C42\uFF1A\u8DEF\u7531\u5230\u5BF9\u5E94\u5E73\u53F0\n        if (!targetUrl) {\n            return new Response(JSON.stringify({ title: null, author: null }), {\n                status: 400,\n                headers: createCorsHeaders(),\n            });\n        }\n\n        if (request.method === 'GET' && resolveOnly) {\n            const userAgent = targetUrl.includes('xhslink.com')\n                ? USER_AGENTS.XIAOHOUGSHU\n                : USER_AGENTS.GENERIC;\n            try {\n                const response = await fetch(targetUrl, {\n                    headers: { 'User-Agent': userAgent },\n                    redirect: 'follow',\n                } as any);\n                const resolvedUrl = response.url || targetUrl;\n                return new Response(JSON.stringify({ resolvedUrl }), {\n                    headers: createCorsHeaders(),\n                });\n            } catch (error: any) {\n                return new Response(JSON.stringify({ resolvedUrl: targetUrl, error: error.message }), {\n                    headers: createCorsHeaders(),\n                });\n            }\n        }\n\n        // \u904D\u5386\u5E73\u53F0\u5904\u7406\u5668\uFF0C\u8FD4\u56DE\u7B2C\u4E00\u4E2A\u80FD\u5904\u7406\u7684\n        for (const platform of PLATFORMS) {\n            if (platform.canHandle(targetUrl)) {\n                const result = await platform.fetchTitle(targetUrl, env);\n                const response = debug\n                    ? JSON.stringify(result)\n                    : (result.title\n                        ? JSON.stringify(result)\n                        : JSON.stringify({ title: null, author: null }));\n                return new Response(response, {\n                    headers: {\n                        ...createCorsHeaders(),\n                        'Cache-Control': result.cached ? 'public, max-age=3600' : 'no-cache',\n                    },\n                });\n            }\n        }\n\n        // \u4E0D\u5E94\u8BE5\u5230\u8FD9\u91CC\uFF0C\u56E0\u4E3A GenericPlatform.canHandle() \u6C38\u8FDC\u8FD4\u56DE true\n        return new Response(JSON.stringify({ error: 'No platform handler found' }), {\n            status: 500,\n            headers: createCorsHeaders(),\n        });\n    }\n};\n\n/**\n * \u5904\u7406\u5206\u7C7B\u8BF7\u6C42\n */\nasync function handleClassify(request: Request, env: Env): Promise<Response> {\n    try {\n        const body = await request.json() as any;\n        const { content, metadata } = body;\n\n        if (!content) {\n            return new Response(JSON.stringify({ error: 'Missing content' }), {\n                status: 400,\n                headers: createCorsHeaders(),\n            });\n        }\n\n        // \u8C03\u7528 LLM \u8FDB\u884C\u5206\u7C7B\n        const glmApiKey = env.GLM_API_KEY;\n        if (!glmApiKey) {\n            return new Response(JSON.stringify({ error: 'GLM API key not configured' }), {\n                status: 500,\n                headers: createCorsHeaders(),\n            });\n        }\n\n        const prompt = `\n${CLASSIFICATION_RULES}\n\n---\n\nInput Content / \u7528\u6237\u8F93\u5165\u539F\u6587:\n\"\"\"\n${content}\n\"\"\"\n\nMetadata / \u5143\u6570\u636E:\n${JSON.stringify(metadata || {}, null, 2)}\n\n\u8BF7\u4E25\u683C\u9075\u5B88 JSON \u683C\u5F0F\u8FD4\u56DE\uFF0C\u786E\u4FDD\u6240\u6709\u5B57\u7B26\u4E32\u5185\u7684\u53CC\u5F15\u53F7\u90FD\u7ECF\u8FC7\u8F6C\u4E49\uFF08\\\\\"\uFF09\uFF0C\u4E0D\u8981\u5305\u542B Markdown \u6807\u8BB0\uFF1A\n{\n  \"category\": \"category_key\"\n}\n`;\n\n        const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${glmApiKey}`,\n            },\n            body: JSON.stringify({\n                model: 'glm-4',\n                messages: [{ role: 'user', content: prompt }],\n                temperature: 0.1,\n                max_tokens: 2000,\n            }),\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text();\n            return new Response(JSON.stringify({ error: 'GLM API Failed', details: errorText }), {\n                status: 500,\n                headers: createCorsHeaders(),\n            });\n        }\n\n        const data = await response.json() as any;\n        let rawContent = data.choices?.[0]?.message?.content?.trim();\n\n        // \u63D0\u53D6 JSON\n        const jsonMatch = rawContent.match(/\\{[\\s\\S]*\\}/);\n        if (jsonMatch) {\n            rawContent = jsonMatch[0];\n        }\n\n        rawContent = rawContent.replace(/^```json\\s*/, '').replace(/^```\\s*/, '');\n\n        let result;\n        try {\n            result = JSON.parse(rawContent);\n        } catch (e) {\n            result = {\n                category: 'others',\n                reasoning: 'JSON Parse Error, Raw: ' + rawContent,\n            };\n        }\n\n        const allowedCategories = new Set(['ideas', 'work', 'personal', 'external', 'others']);\n        if (!result || typeof result.category !== 'string' || !allowedCategories.has(result.category)) {\n            result = {\n                category: metadata?.isLink ? 'external' : 'others',\n                reasoning: 'Invalid category from model, fallback applied',\n            };\n        }\n\n        return new Response(JSON.stringify(result), {\n            headers: createCorsHeaders(),\n        });\n    } catch (error: any) {\n        return new Response(JSON.stringify({ error: 'Internal Error', details: error.message }), {\n            status: 500,\n            headers: createCorsHeaders(),\n        });\n    }\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/lukelei/Vibe coding projects/workbench/worker/src/index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/Users/lukelei/.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/Users/lukelei/.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/lukelei/Vibe coding projects/workbench/worker/src/index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/lukelei/Vibe coding projects/workbench/worker/.wrangler/tmp/bundle-GgPM8m/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/Users/lukelei/.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/lukelei/Vibe coding projects/workbench/worker/.wrangler/tmp/bundle-GgPM8m/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/lukelei/Vibe coding projects/workbench/worker/.wrangler/tmp/bundle-GgPM8m/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["fallback"]
}
